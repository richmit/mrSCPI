<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class SCPIsession - mrSCPI</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#class-SCPIsession-label-Introduction">Introduction</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters">SCPIsession State Parameters</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Global+behavior">SCPIsession State Parameters: Global behavior</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Command+string+specification">SCPIsession State Parameters: Command string specification</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Instrument+I-2FO+tuning">SCPIsession State Parameters: Instrument I/O tuning</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Connection+Parameters">SCPIsession State Parameters: Connection Parameters</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Output+Control">SCPIsession State Parameters: Output Control</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Result+processing">SCPIsession State Parameters: Result processing</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Result+storage">SCPIsession State Parameters: Result storage</a>
    <li><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Macros">SCPIsession State Parameters: Macros</a>
  </ul>
</div>


  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">Object
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-command">#command</a>
    <li ><a href="#method-i-execute">#execute</a>
    <li ><a href="#method-i-expand">#expand</a>
    <li ><a href="#method-i-result">#result</a>
    <li ><a href="#method-i-set">#set</a>
    <li ><a href="#method-i-variable">#variable</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-SCPIsession">
  <h1 id="class-SCPIsession" class="class">
    class SCPIsession
  </h1>

  <section class="description">
    
<h1 id="class-SCPIsession-label-Introduction">Introduction<span><a href="#class-SCPIsession-label-Introduction">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="SCPIsession.html"><code>SCPIsession</code></a> manages network connections and connection state for SPCI sessions.</p>

<h1 id="class-SCPIsession-label-SCPIsession+State+Parameters"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The object is controlled via changing the object’s state parameters. I know, that’s not much to go on.  It’s really pretty simple.  A few examples are probably the best way to understand it.  See the mrSCPI readme.</p>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Global+behavior"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Global behavior<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Global+behavior">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li><dl class="rdoc-list note-list"><dt><code>:verbose</code>(P/Integer)
<dd>
<p>How much to print to <code>:log_file</code> (DEFAULT: <code>1</code>)</p>
</dd></dl>

<p>Values:</p>
<ul><li>
<p><code>0</code>: Silent</p>
</li><li>
<p><code>1</code>: Errors</p>
</li><li>
<p><code>2</code>: Warnings</p>
</li><li>
<p><code>3</code>: Information</p>
</li><li>
<p><code>4</code>: Debug-4</p>
</li><li>
<p><code>5</code>: Debug-5 Same as Debug4 (TODO: Future Feature)</p>
</li><li>
<p><code>6</code>: Debug-6 Same as Debug4 (TODO: Future Feature)</p>
</li><li>
<p><code>7</code>: Debug-7 Same as Debug4 (TODO: Future Feature)</p>
</li><li>
<p><code>8</code>: Debug-8 Print out data structures</p>
</li></ul>
</li><li><dl class="rdoc-list note-list"><dt><code>:exit_on_error</code>(L/Boolean)
<dd>
<p>Exit if an error is encountered (DEFAULT: true)</p>
</dd></dl>

<p>See: <a href="PrintyPrintyBangBang.html"><code>PrintyPrintyBangBang</code></a></p>
</li><li><dl class="rdoc-list note-list"><dt><code>:exit_0</code>(L/Boolean)
<dd>
<p>Abnormal exits are always zero – required for org-mode (DEFAULT: <code>false</code>)</p>
</dd></dl>

<p>See: <a href="PrintyPrintyBangBang.html"><code>PrintyPrintyBangBang</code></a></p>
</li><li><dl class="rdoc-list note-list"><dt><code>:execute_on_cmd</code>(Boolean)
<dd>
<p>Immediately execute when :cmd is updated (DEFAULT: <code>true</code>)</p>
</dd></dl>

<p>If false, then the <a href="SCPIsession.html#method-i-execute"><code>execute</code></a> method must be used to force command execution</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:log_file</code>(L/String)
<dd>
<p>Name of file for log messages (DEFAULT: <code>&quot;STDERR&quot;</code>)</p>
</dd></dl>

<p>Some file names are special: <code>&quot;STDOUT&quot;</code>, <code>&quot;STDERR&quot;</code>, &amp; <code>&quot;/dev/null&quot;</code> See: <a href="PrintyPrintyBangBang.html"><code>PrintyPrintyBangBang</code></a></p>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Command+string+specification"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Command string specification<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Command+string+specification">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li><dl class="rdoc-list note-list"><dt><code>:cmd</code>(String)
<dd>
<p>The current command string</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:scpi_prefix</code>(String)
<dd>
<p>An SCPI prefix to be added when :cmd is sent to instrument (DEFAULT: <code>&quot;&quot;</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:eol</code>(String)
<dd>
<p>End of line string to append to command strings sent to instrument (DEFAULT: <code>&quot;\n&quot;</code>)</p>
</dd></dl>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Instrument+I-2FO+tuning"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Instrument I/O tuning<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Instrument+I-2FO+tuning">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li><dl class="rdoc-list note-list"><dt><code>:read_timeout_first_byte</code>(Integer/milliseconds)
<dd>
<p>Timeout for first byte of data from instrument.</p>
</dd></dl>

<p>Default depends on :net_protocol: </p>
<dl class="rdoc-list note-list"><dt><code>:raw</code>
<dd>
<p>1000</p>
</dd><dt><code>:soip</code>
<dd>
<p>500</p>
</dd><dt><code>:plgx</code>
<dd>
<p>500</p>
</dd><dt><code>:file</code>
<dd>
<p>0</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:read_timeout_next_byte</code>(Integer/milliseconds)
<dd>
<p>Timeout for more data after receiving a response from instrument</p>
</dd></dl>

<p>Default depends on :net_protocol: </p>
<dl class="rdoc-list note-list"><dt><code>:raw</code>
<dd>
<p>2000</p>
</dd><dt><code>:soip</code>
<dd>
<p>100</p>
</dd><dt><code>:plgx</code>
<dd>
<p>100</p>
</dd><dt><code>:file</code>
<dd>
<p>0</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:delay_before_first_read</code>(Integer/milliseconds)
<dd>
<p>Time to wait before trying to read a result from instrument</p>
</dd></dl>

<p>Default depends on :net_protocol: </p>
<dl class="rdoc-list note-list"><dt><code>:raw</code>
<dd>
<p>100</p>
</dd><dt><code>:soip</code>
<dd>
<p>50</p>
</dd><dt><code>:plgx</code>
<dd>
<p>50</p>
</dd><dt><code>:file</code>
<dd>
<p>0</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:delay_after_complete</code>(Integer/milliseconds)
<dd>
<p>Time to wait after a command has completed before returning</p>
</dd></dl>

<p>Default depends on :net_protocol: </p>
<dl class="rdoc-list note-list"><dt><code>:raw</code>
<dd>
<p>0</p>
</dd><dt><code>:soip</code>
<dd>
<p>100</p>
</dd><dt><code>:plgx</code>
<dd>
<p>50</p>
</dd><dt><code>:t3k</code>
<dd>
<p>200</p>
</dd><dt><code>:file</code>
<dd>
<p>0</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:read_retry_delay</code>(Integer/milliseconds)
<dd>
<p>Time to wait before retrying a read operation</p>
</dd></dl>

<p>Default depends on :net_protocol: </p>
<ul><li><dl class="rdoc-list note-list"><dt><code>:raw</code>
<dd>
<p>200</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:soip</code>
<dd>
<p>200</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:plgx</code>
<dd>
<p>100</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:file</code>
<dd>
<p>0</p>
</dd></dl>
</li></ul>
</li><li><dl class="rdoc-list note-list"><dt><code>:read_eot_sentinel</code>(nil|String)
<dd>
<p>Stop reading when the character appears on the input stream (DEFAULT: <code>nil</code>)</p>
</dd></dl>

<p>This can dramatically speed up query commands, but requires the instrument send an “end of transmission” character. Frequently we can exploit the fact that an instrument will terminate some responses with a newline character, and thus use the newline as an EOT character.  For Prologix devices, an EOT character may be defined; however, this can interfere when binary data is to be transmitted from an instrument.</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:good_std_eot</code>(P/Boolean)
<dd>
<p>Set <code>:read_eot_sentinel</code> to <code>&quot;\n&quot;</code> if <code>true</code>, and to <code>nil</code> if <code>false</code>.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:socket_close_write</code>(Boolean)
<dd>
<p>For raw &amp; soip do a write_close on the TCP socket after sending command string (DEFAULT: <code>false</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:socket_close</code>(Boolean)
<dd>
<p>For raw &amp; soip do a close on the TCP socket after reading is complete (DEFAULT: <code>false</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:read_buffer_size</code>(Integer/bytes)
<dd>
<p>Maximum number of bytes to attempt to read at once (DEFAULT: <code>1048576</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:read_max_bytes</code>(Integer/bytes)
<dd>
<p>Stop reading after we get this many bytes or more (DEFAULT: <code>nil</code>)</p>
</dd></dl>

<p>This is useful when transfusing data from the instrument and you know exactly how much data to expect</p>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Connection+Parameters"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Connection Parameters<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Connection+Parameters">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Connection parameters may only be set when an <a href="SCPIsession.html"><code>SCPIsession</code></a> object is created (via new).</p>
<ul><li><dl class="rdoc-list note-list"><dt><code>:url</code>(P/String)
<dd>
<p>Used to set <code>:ip_address</code> and potentially <code>:net_protocol</code> &amp; <code>:net_port</code>. If any of these options are explicitly set, then the explicitly set value wins. </p>
</dd></dl>

<p>URL formats: </p>
<ul><li>
<p><code>[net_protocol://]ip_address[:net_port]</code></p>
</li><li>
<p><code>[network]@nickname</code> — Note nicknames <strong>always</strong> contain an <code>@</code></p>
</li></ul>

<p>See: <a href="SCPIrcFile.html#method-i-urlParser"><code>SCPIrcFile.urlParser</code></a> &amp; <a href="SCPIrcFile.html#method-i-lookupURLnickname"><code>SCPIrcFile.lookupURLnickname</code></a></p>
</li><li><dl class="rdoc-list note-list"><dt><code>:ip_address</code>(String)
<dd>
<p>IP address</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:net_protocol</code>(Symbol)
<dd>
<p>Network protocol. </p>
</dd></dl>

<p>Values: </p>
<ul><li><dl class="rdoc-list note-list"><dt><code>:raw</code>
<dd>
<p>Raw socket connection (DEFAULT)</p>
</dd></dl>

<p>By far the most well tested mode as most of my equipment has an Ethernet port.</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:soip</code>
<dd>
<p>Serial Over IP</p>
</dd></dl>

<p>Designed for serial console servers or Ethernet to serial converters with a raw TCP/IP socket interface.  The <code>:socket_close_write</code> parameter may break connections on console servers that use connection status to set serial hardware flow control.  These devices may require longer timeouts. This feature has been tested with the following hardware:</p>
<ul><li>
<p>Lantronix EDS4100 Terminal Server</p>
</li><li>
<p>Keysight 34401A Bench Digital Multimeter</p>
</li><li>
<p>Tektronix TDS3052B Digital Phosphor Oscilloscope</p>
</li><li>
<p>Tektronix TDS2024 Digital Storage Oscilloscope</p>
</li></ul>
</li><li><dl class="rdoc-list note-list"><dt><code>:t3k</code>
<dd>
<p>SCPI over HTTP for TDS3000B series</p>
</dd></dl>

<p>Sends SCPI commands via an HTTP form, and scrapes the result out of the returned HTML document.  Do not use commands that return binary data.  Also note that TCP/IP read loop is bypassed for this mode, and so read timeouts and delays are ignored.</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:lxi</code>
<dd>
<p>VX11/LXI over IP (TODO: Future Feature)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:plgx</code>
<dd>
<p>SCPI via a Prologix Ethernet adapter</p>
</dd></dl>

<p>The Prologix adapter configured with the following commands when the TCP/IP port is opened:</p>

<pre>++savecfg 0 ..... Prevents permanent adapter config changes, and extends EPROM life
++mode 1 ........ Sets adapter to be a controller
++auto 0 ........ Turns off read after write avoiding errors on some equipment
++eoi 1 ......... Turns on end of input
++read_tmo_ms ... Set to :read_timeout_first_byte - 50
++eos ........... Set based on :eol value</pre>

<p>If <code>:result_type</code> is non-<code>nil</code>, then an <code>&#39;++read eoi&#39;</code> command is issued before the TCP/IP read loop.  This is sent <strong>before</strong> the <code>:delay_before_first_read</code>. This feature has been tested with the following hardware:</p>
<ul><li>
<p>Keysight 34401A Bench Digital Multimeter</p>
</li><li>
<p>Tektronix TDS3052B Digital Phosphor Oscilloscope</p>
</li></ul>

<p>If <code>:read_timeout_first_byte</code> or <code>:eol</code> is changed after the socket is opened, set <code>:socket_close</code> to close the socket after the next command.  This will be fixed someday.</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:file</code>
<dd>
<p>Read response from a file with the same name as :cmd parameter</p>
</dd></dl>

<p>This feature is used for simulating SCPI responce strings without a physical device.  It is used for testing.</p>
</li></ul>
</li><li><dl class="rdoc-list note-list"><dt><code>:net_port</code>(Integer)
<dd>
<p>TCP/IP Port number (DEFAULT: 0 for <code>:file</code>, <code>:soip</code>, &amp; <code>:lxi</code>.  5025 for <code>:raw</code>. 1234 for <code>:plgx</code>. 80 for <code>:t3k</code>)</p>
</dd></dl>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Output+Control"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Output Control<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Output+Control">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li><dl class="rdoc-list note-list"><dt><code>:out_file</code>(L/String)
<dd>
<p>Filename for print operations – not log operations (DEFAULT: <code>&quot;STDOUT&quot;</code>)</p>
</dd></dl>

<p>Some file names are special: <code>&quot;STDOUT&quot;</code>, <code>&quot;STDERR&quot;</code>, &amp; <code>&quot;/dev/null&quot;</code> See: <a href="PrintyPrintyBangBang.html"><code>PrintyPrintyBangBang</code></a></p>
</li><li><dl class="rdoc-list note-list"><dt><code>:print_raw_result</code>(Boolean)
<dd>
<p>Output raw results (the raw string returned from the instrument) to :out_file (DEFAULT: <code>false</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:print_result</code>(Boolean)
<dd>
<p>Output post processed results to :out_file (DEFAULT: <code>false</code>)</p>
</dd></dl>

<p>Nothing is printed when <code>:result_type</code> is <code>nil</code> WARNING: <a href="SCPIsequence.html"><code>SCPIsequence</code></a> sets this to true when it constructs an <a href="SCPIsession.html"><code>SCPIsession</code></a> object</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:print_result_puts</code>(Boolean)
<dd>
<p>Use <code>puts</code> for prints – i.e. insure all prints have a newline at the end</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:print_cmd</code>(Boolean)
<dd>
<p>Output command to :out_file (DEFAULT: <code>false</code>)</p>
</dd></dl>

<p>Output is prefixed and postfixed by <code>&#39;&gt;&gt;&#39;</code> and followed by a newline WARNING: <a href="SCPIsequence.html"><code>SCPIsequence</code></a> sets this to true when it constructs an <a href="SCPIsession.html"><code>SCPIsession</code></a> object</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:echo</code>(P/Boolean)
<dd>
<p>Sets both <code>:print_cmd</code> &amp; <code>:print_result</code> at the same time (DEFAULT: <code>false</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:print_debug</code>(L/Boolean)
<dd>
<p>All printed results are in Ruby <code>.inspect</code> format and followed by a newline</p>
</dd></dl>

<p>See: <a href="PrintyPrintyBangBang.html"><code>PrintyPrintyBangBang</code></a></p>
</li><li><dl class="rdoc-list note-list"><dt><code>:print_max_len</code>(L/Integer or nil)
<dd>
<p>Limit the number of characters printed (DEFAULT: <code>nil</code>)</p>
</dd></dl>

<p>If a print is truncated, then the next line in :out_file will be something like:</p>

<pre>LAST LINE TRUNCATED (:print_max_len=N)</pre>

<p>See: <a href="PrintyPrintyBangBang.html"><code>PrintyPrintyBangBang</code></a></p>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Result+processing"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Result processing<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Result+processing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Strings returned from instruments can be processed via a standard set of transformations controlled by the options in this section.  The actions occur in the order they are documented in this section.  For example, operations after <code>:result_split</code> are applied each array element resulting from the split. If <code>:result_type</code> is <code>nil</code>, none of these actions are taken.</p>
<ul><li><dl class="rdoc-list note-list"><dt><code>:result_extract_block</code>(Boolean)
<dd>
<p>If true and a block header is present, then replace the result sting with the data payload.  Otherwise leave the string unmodified.</p>
</dd></dl>

<p>A block header starts with a literal pound character <code>#</code> and a single hex digit indicating the number of decimal digits that follow.</p>

<p>If this digit is zero, then we have a variable sized block that ends with an EOL terminator.</p>

<p>If the digit is non-zero, then it tells us the number of ASCII decimal digits that follow it indicate the length of the data payload.</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_split</code>(Symbol)
<dd>
<p>If non-nil, then split the result sting into an array. (DEFAULT: <code>nil</code>)</p>
</dd></dl>

<p>Values:</p>
<ul><li><dl class="rdoc-list note-list"><dt><code>nil</code>
<dd>
<p>Don’t do anything – no split at all</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:char</code>
<dd>
<p>Split on the characters in <code>:result_split_arg</code></p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:string</code>
<dd>
<p>Split on the <strong>string</strong> in  <code>:result_split_arg</code></p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:unpack</code>
<dd>
<p>Split via an unpack string in <code>:result_split_arg</code></p>
</dd></dl>

<p>WARNING: unpack may produce an array containing non-strings, and thus :result_type must usually be set to :mixed!</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:block</code>
<dd>
<p>Split into two element array containing block header and block payload</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:regex</code>
<dd>
<p>Split via the regex string in <code>:result_split_arg</code></p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:line</code>
<dd>
<p>Split on horizontal whitespace</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:space</code>
<dd>
<p>Split on /s+/ (i.e. whitespace separated values)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:csv</code>
<dd>
<p>Split on /s*,s*/ (i.e. comma separated values)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:ssv</code>
<dd>
<p>Split on /s*;s*/ (i.e. semicolon separated values)</p>
</dd></dl>

<p>Handy for devices (R&amp;S) that return semicolon separated values on compound SCPI statements Example: </p>

<pre>:measure: SCALar:VOLTage:DC?; :MEASure:SCALar:CURRent:DC?
&quot;0.0; 0.0&quot;</pre>
</li></ul>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_split_arg</code>(String or nil)
<dd>
<p>Argument required for the <code>:result_split</code> parameter.  (DEFAULT: <code>nil</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_squeeze</code>(Boolean)
<dd>
<p>If true, adjacent whitespace characters are squeezed into a single character – a single space or newline</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_chomp</code>(Boolean)
<dd>
<p>If true, the stored/returned result string is chomped (DEFAULT: <code>false</code>)</p>
</dd></dl>

<p>Note overlap with <code>:result_strip</code>!</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_strip</code>(Boolean)
<dd>
<p>If true, the stored/returned result string is stripped of whitespace (DEFAULT: <code>false</code>)</p>
</dd></dl>

<p>Zaps <code>NL</code> (null), <code>HT</code> (horizontal tab), <code>LF</code> (line feed), <code>VT</code> (vertical tab), <code>FF</code> (form feed), <code>CR</code> (carriage return), &amp; <code>SP</code> (space)</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_last_word</code>(Boolean)
<dd>
<p>If true, the stored/returned result string is right stripped and only the last word is returned (DEFAULT: <code>false</code>)</p>
</dd></dl>

<p>Some instruments return the query command string followed by the value, and this can be a handy way to get just the value. Example: </p>

<pre>MEASUrement:IMMed:VALue?
:measurement: IMMED:VALUE 9.9E37</pre>
</li><li><dl class="rdoc-list note-list"><dt><code>:result_type</code>(Boolean)
<dd>
<p>Expected return from SCPI command (DEFAULT: <code>nil</code>)</p>
</dd></dl>

<p>Used to coerce values into Ruby types Values:</p>
<ul><li><dl class="rdoc-list note-list"><dt><code>nil</code>
<dd>
<p>no data – A response is not even read from instrument</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:mixed</code>
<dd>
<p>When <code>:result_split</code> is non-NIL, leave returned data as is.</p>
</dd></dl>

<p>NOTE: Usually the correct value when <code>:result_split</code> is :unpack!</p>
</li><li><dl class="rdoc-list note-list"><dt><code>:string</code>
<dd>
<p>string.  Usually a NOP except, when <code>:result_split</code> values of :unpack.  In the :unpack case, this will convert any non-string elements in an array into strings.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:float</code>
<dd>
<p>float (NR2, NR3, NRf) – NRf is only partly supported in that whitespace is not allowed around the “E”.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:int</code>
<dd>
<p>integer (NR1)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:bool</code>
<dd>
<p>Convert strings to <code>true</code>, <code>false</code>, or <code>nil</code></p>
</dd></dl>
<ul><li><dl class="rdoc-list note-list"><dt><code>true</code>
<dd>
<p>if result =~ /^s*(on|1|true|yes)s*$/i</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>false</code>
<dd>
<p>if result =~ /^s*(off|0|false|no)s*$/i</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>nil</code>
<dd>
<p>otherwise</p>
</dd></dl>
</li></ul>

<p>Non-strings are left untouched</p>
</li></ul>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Result+storage"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Result storage<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Result+storage">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li><dl class="rdoc-list note-list"><dt><code>:name</code>(String)
<dd>
<p>Name of current command.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:store_named_in_var</code>(Boolean)
<dd>
<p>Store named results into a variable of the same name (DEFAULT: <code>true</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:store_last_in_ans</code>(Boolean)
<dd>
<p>Store result into a variable named ‘ANS’ (DEFAULT: <code>true</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:store_results</code>(Boolean)
<dd>
<p>Store the instrument response on the results stack (DEFAULT: <code>true</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:store_raw_results</code>(Boolean)
<dd>
<p>Store the raw instrument response string on the results stack (DEFAULT: <code>true</code>)</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:store_cmd</code>(Boolean)
<dd>
<p>Store the raw command string sent to the instrument on the results stack (DEFAULT: <code>true</code>)</p>
</dd></dl>
</li></ul>

<h2 id="class-SCPIsession-label-SCPIsession+State+Parameters-3A+Macros"><a href="SCPIsession.html"><code>SCPIsession</code></a> State Parameters: Macros<span><a href="#class-SCPIsession-label-SCPIsession+State+Parameters-3A+Macros">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The following pseudo-options are provided for connivance, and are equivalent to setting several other options simultaneously.  Like all option-like entities, these pseudo-options take an argument.  This argument <strong>must</strong> be provided even if the macro ignores it.</p>

<pre>- Result processing &amp; Output Control Macros
                                 :result_extract_block :result_split :result_chomp :result_strip :result_last_word :result_type :print_max_len :print_debug
  - :result_macro_bin (P) ....... false                 nil           false         false         false             :string      nil            false
  - :result_macro_block (P) ..... true                  nil           false         false         false             :string      nil            false
  - :result_macro_ascii (P) ..... false                 nil           true          true          false             :string      nil            false
  - :result_macro_debug (P) ..... false                 nil           true          true          false             :string      256            true
  - :result_macro_csv (P) ....... false                 &#39;,&#39;           true          true          false             :string      nil            false</pre>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">





     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(options)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 428</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-ivar">@re</span>           = <span class="ruby-constant">SCPIregexLibrary</span>.<span class="ruby-identifier">instance</span>
  <span class="ruby-ivar">@gblOpt</span>       = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@tcpSocket</span>    = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@results</span>      = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@varList</span>      = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@validProto</span>   = [<span class="ruby-value">:raw</span>, <span class="ruby-value">:soip</span>, <span class="ruby-value">:lxi</span>, <span class="ruby-value">:plgx</span>, <span class="ruby-value">:t3k</span>, <span class="ruby-value">:file</span>]
  <span class="ruby-ivar">@validType</span>    = [<span class="ruby-keyword">nil</span>, <span class="ruby-value">:mixed</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:float</span>, <span class="ruby-value">:int</span>, <span class="ruby-value">:bool</span>]
  <span class="ruby-ivar">@validSplits</span>  = [<span class="ruby-keyword">nil</span>, <span class="ruby-value">:char</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:space</span>, <span class="ruby-value">:unpack</span>, <span class="ruby-value">:block</span>, <span class="ruby-value">:regex</span>, <span class="ruby-value">:line</span>, <span class="ruby-value">:csv</span>, <span class="ruby-value">:ssv</span>]
  <span class="ruby-ivar">@gblOptReqPsu</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">validOptions</span> <span class="ruby-operator">+</span> [ <span class="ruby-value">:url</span> ])
  <span class="ruby-ivar">@gblOptReqNew</span> = { <span class="ruby-value">:ip_address</span>               <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)               },
                    <span class="ruby-value">:net_port</span>                 <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">65535</span>)    },
                    <span class="ruby-value">:net_protocol</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@validProto</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                            },
                  }
  <span class="ruby-ivar">@gblOptReqRun</span> = { <span class="ruby-value">:cmd</span>                      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)               },
                    <span class="ruby-value">:delay_after_complete</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>)                    },
                    <span class="ruby-value">:delay_before_first_read</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>)                    },
                    <span class="ruby-value">:eol</span>                      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>))                                 },
                    <span class="ruby-value">:execute_on_cmd</span>           <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:name</span>                     <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>))   },
                    <span class="ruby-value">:print_cmd</span>                <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-comment">#print_debug              Part of PrintyPrintyBangBang</span>
                    <span class="ruby-comment">#print_max_len            Part of PrintyPrintyBangBang</span>
                    <span class="ruby-value">:print_raw_result</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:print_result</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:read_buffer_size</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)                     },
                    <span class="ruby-value">:read_eot_sentinel</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>))   },
                    <span class="ruby-value">:read_max_bytes</span>           <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>))         },
                    <span class="ruby-value">:read_retry_delay</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>)                    },
                    <span class="ruby-value">:read_timeout_first_byte</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>)                    },
                    <span class="ruby-value">:read_timeout_next_byte</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>)                    },
                    <span class="ruby-value">:result_chomp</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:result_extract_block</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:result_last_word</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:result_split</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@validSplits</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                           },
                    <span class="ruby-value">:result_split_arg</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>))   },
                    <span class="ruby-value">:result_squeeze</span>           <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:result_strip</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:result_type</span>              <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@validType</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                             },
                    <span class="ruby-value">:scpi_prefix</span>              <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)                                   },
                    <span class="ruby-value">:socket_close</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:socket_close_write</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:store_cmd</span>                <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:store_last_in_ans</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:store_named_in_var</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:store_raw_results</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:store_results</span>            <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">x</span>)                          },
                    <span class="ruby-value">:var</span>                      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>))   },
                  }

  <span class="ruby-comment"># Set initial parameter values</span>
  <span class="ruby-identifier">set</span>({ <span class="ruby-comment">#delay_after_complete     Set from proto</span>
        <span class="ruby-comment">#delay_before_first_read  Set from proto</span>
        <span class="ruby-value">:eol</span>                  <span class="ruby-operator">=&gt;</span>        <span class="ruby-string">&quot;\n&quot;</span>,
        <span class="ruby-value">:execute_on_cmd</span>       <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:name</span>                 <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
        <span class="ruby-value">:exit_0</span>               <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:exit_on_error</span>        <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:print_cmd</span>            <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:print_debug</span>          <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:print_max_len</span>        <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
        <span class="ruby-value">:print_raw_result</span>     <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:print_result</span>         <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:read_buffer_size</span>     <span class="ruby-operator">=&gt;</span>     <span class="ruby-value">1048576</span>,
        <span class="ruby-value">:read_eot_sentinel</span>    <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
        <span class="ruby-value">:read_max_bytes</span>       <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
        <span class="ruby-comment">#read_retry_delay         Set from proto</span>
        <span class="ruby-comment">#read_timeout_first_byte  Set from proto</span>
        <span class="ruby-comment">#read_timeout_next_byte   Set from proto</span>
        <span class="ruby-value">:result_chomp</span>         <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:result_extract_block</span> <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:result_last_word</span>     <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:result_split</span>         <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
        <span class="ruby-value">:result_split_arg</span>     <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
        <span class="ruby-value">:result_squeeze</span>       <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:result_strip</span>         <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:result_type</span>          <span class="ruby-operator">=&gt;</span>     <span class="ruby-value">:string</span>,
        <span class="ruby-value">:scpi_prefix</span>          <span class="ruby-operator">=&gt;</span>          <span class="ruby-string">&#39;&#39;</span>,
        <span class="ruby-value">:socket_close</span>         <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:socket_close_write</span>   <span class="ruby-operator">=&gt;</span>       <span class="ruby-keyword">false</span>,
        <span class="ruby-value">:store_cmd</span>            <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:store_last_in_ans</span>    <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:store_named_in_var</span>   <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:store_raw_results</span>    <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:store_results</span>        <span class="ruby-operator">=&gt;</span>        <span class="ruby-keyword">true</span>,
        <span class="ruby-value">:var</span>                  <span class="ruby-operator">=&gt;</span>         <span class="ruby-keyword">nil</span>,
      }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-command" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">command</span><span
            class="method-args">(cmd, options=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>While <code>.set</code> perfectly capable of setting the <code>:cmd</code> parameter, this method provides provides a more readable alternative.</p>

          <div class="method-source-code" id="command-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 635</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">command</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">options</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value">:cmd</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-string">&quot;ERROR: :cmd must not appear in options list when calling &#39;command&#39;!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">74</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Set options first -- so we don&#39;t trigger automatic execution.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>
    <span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Now set command by ourselves without the set method so we can execute the command ourselves and return a result if :execute_on_cmd is on</span>
  <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:cmd</span>] = <span class="ruby-identifier">cmd</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:execute_on_cmd</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Attempting automatic execution&quot;</span>, <span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute</span>()
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-execute" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">execute</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This method executes the command specified by the <code>:cmd</code> parameter.  This is method is completely unnecessary if the <code>:execute_on_cmd</code> parameter is non-<code>nil</code>.</p>

          <div class="method-source-code" id="execute-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 691</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">execute</span>()
  <span class="ruby-identifier">time_exe_start</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-comment"># Make sure all required options required by new are set and valid</span>
  <span class="ruby-ivar">@gblOptReqRun</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">validator</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">validator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-identifier">k</span>])) <span class="ruby-keyword">then</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Unable to execute.  Execution option is invalid: #{k.inspect} = #{@gblOpt[k].inspect}!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">76</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Execution options are good&quot;</span>, <span class="ruby-keyword">self</span>)
  <span class="ruby-comment"># We are good to go!</span>
  <span class="ruby-identifier">curCmd</span> = <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:cmd</span>]
  <span class="ruby-identifier">strToSend</span> = <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:scpi_prefix</span>] <span class="ruby-operator">+</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:cmd</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:plgx</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">strToSend</span> = <span class="ruby-identifier">strToSend</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">strToSend</span> = <span class="ruby-identifier">strToSend</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:eol</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:print_cmd</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">outPrinter</span>(<span class="ruby-node">&quot;&gt;&gt;#{strToSend.chomp.strip}&gt;&gt;&quot;</span>, <span class="ruby-identifier">newline</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">strWeGot</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:file</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Opening file&quot;</span>, <span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">strWeGot</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">curCmd</span>, <span class="ruby-string">&quot;rb&quot;</span>).<span class="ruby-identifier">read</span>();
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Unable to open file #{curCmd}!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">87</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:print_raw_result</span>] <span class="ruby-keyword">then</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">outPrinter</span>(<span class="ruby-identifier">strWeGot</span>, <span class="ruby-identifier">newline</span>=<span class="ruby-keyword">false</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> [<span class="ruby-value">:raw</span>, <span class="ruby-value">:soip</span>, <span class="ruby-value">:plgx</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>]) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Opening Socket&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-keyword">begin</span>
          <span class="ruby-ivar">@tcpSocket</span> = <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:ip_address</span>], <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_port</span>])
        <span class="ruby-keyword">rescue</span>
          <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-string">&quot;ERROR: Unable to open TCP/IP socket!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">82</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:plgx</span> <span class="ruby-keyword">then</span>
          <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Sending :plgx startup instructions&quot;</span>, <span class="ruby-keyword">self</span>)
          <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;++mode 1\n&quot;</span>)
          <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;++savecfg 0\n&quot;</span>)
          <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;++auto 0\n&quot;</span>)
          <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;++eoi 1\n&quot;</span>)
          <span class="ruby-comment"># We only do these when we open the socket.  Unfortunatly that means we miss :eol and :read_timeout_next_byte changes after socket open... BUG TODO</span>
          <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-node">&quot;++read_tmo_ms #{[50, @gblOpt[:read_timeout_first_byte]-50].max}\n&quot;</span>)
          <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;++eos &quot;</span> <span class="ruby-operator">+</span> ({<span class="ruby-string">&quot;\0d\0a&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;0&#39;</span>, <span class="ruby-string">&quot;\0d&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;1&#39;</span>, <span class="ruby-string">&quot;\0a&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;2&#39;</span>}[<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:eol</span>]] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;3&#39;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>)
          <span class="ruby-comment">#@tcpSocket.write(&quot;++ifc\n&quot;)</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Sending Command: #{strToSend.inspect}&quot;</span>, <span class="ruby-keyword">self</span>)
      <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">strToSend</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:plgx</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Sending :plgx ++read instruction.&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;++read eoi\n&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:socket_close_write</span>] <span class="ruby-keyword">then</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Closing TCP write connection.&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">close_write</span>()
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:delay_before_first_read</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
          <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: DELAY: Pre-read delay_time = #{@gblOpt[:delay_before_first_read]}ms.&quot;</span>, <span class="ruby-keyword">self</span>)
          <span class="ruby-identifier">sleep</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:delay_before_first_read</span>]<span class="ruby-operator">/</span><span class="ruby-value">1000.0</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Read loop starting...&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-identifier">time_send</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-identifier">time_read</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">total_recvd</span> = <span class="ruby-value">0</span>
        <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
          <span class="ruby-keyword">begin</span>
            <span class="ruby-identifier">recvd_data</span> = <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">recv_nonblock</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_buffer_size</span>])
            <span class="ruby-identifier">strWeGot</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">recvd_data</span>
            <span class="ruby-identifier">recvd_length</span> = <span class="ruby-identifier">recvd_data</span>.<span class="ruby-identifier">length</span>()
            <span class="ruby-identifier">total_recvd</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">recvd_length</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_read</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
              <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: Received #{recvd_length} bytes in first read.&quot;</span>, <span class="ruby-keyword">self</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: Received #{recvd_length} bytes in last read.  Total of #{total_recvd} so far.&quot;</span>, <span class="ruby-keyword">self</span>)
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">time_read</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">new</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:print_raw_result</span>] <span class="ruby-keyword">then</span>
              <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">outPrinter</span>(<span class="ruby-identifier">recvd_data</span>, <span class="ruby-identifier">newline</span>=<span class="ruby-keyword">false</span>)
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">recvd_length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_recvd</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-string">&quot;INFO: Received no data.  Transmission complete.&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">else</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Received nothing in last read.  Total of #{total_recvd}.  Transmission complete.&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_eot_sentinel</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">recvd_data</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_eot_sentinel</span>]) <span class="ruby-keyword">then</span>
              <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Received #{total_recvd} bytes and EOT sentinel.  Transmission complete.&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_max_bytes</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">total_recvd</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_max_bytes</span>]) <span class="ruby-keyword">then</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_recvd</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_max_bytes</span>] <span class="ruby-keyword">then</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Received #{total_recvd}.  As expected.  Transmission complete.&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">else</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">2</span>, <span class="ruby-node">&quot;WARNING: Received #{total_recvd}.  Only expected #{@gblOpt[:read_max_bytes]}.  Transmission complete.&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">rescue</span> <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">WaitReadable</span>
            <span class="ruby-identifier">time_now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_read</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
              <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">time_now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time_send</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">delta</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">2</span>, <span class="ruby-node">&quot;WARNING: Instrument has not responded in #{delta} seconds&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">else</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Instrument has not responded in #{delta} seconds&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_timeout_first_byte</span>] <span class="ruby-operator">&lt;</span> (<span class="ruby-identifier">delta</span><span class="ruby-operator">*</span><span class="ruby-value">1000</span>) <span class="ruby-keyword">then</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-string">&quot;ERROR: Giving up due to first byte timeout&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-keyword">nil</span>);
                <span class="ruby-keyword">break</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_retry_delay</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
                  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: DELAY: io_retry_delay = #{@gblOpt[:delay_before_first_read]}ms.&quot;</span>, <span class="ruby-keyword">self</span>)
                  <span class="ruby-identifier">sleep</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_retry_delay</span>]<span class="ruby-operator">/</span><span class="ruby-value">1000.0</span>)
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">time_now</span><span class="ruby-operator">-</span><span class="ruby-identifier">time_read</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">delta</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Received #{total_recvd} bytes. No new data received for #{delta} seconds&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">else</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: Received #{total_recvd} bytes. No new data received for #{delta} seconds&quot;</span>, <span class="ruby-keyword">self</span>)
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_timeout_next_byte</span>] <span class="ruby-operator">&lt;</span> (<span class="ruby-value">1000</span><span class="ruby-operator">*</span><span class="ruby-identifier">delta</span>) <span class="ruby-keyword">then</span>
                <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Received #{total_recvd} bytes. Assuming no more data to receive.&quot;</span>, <span class="ruby-keyword">self</span>);
                <span class="ruby-keyword">break</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_retry_delay</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
                  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: DELAY: io_retry_delay = #{@gblOpt[:delay_before_first_read]}ms.&quot;</span>, <span class="ruby-keyword">self</span>)
                  <span class="ruby-identifier">sleep</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:read_retry_delay</span>]<span class="ruby-operator">/</span><span class="ruby-value">1000.0</span>)
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">retry</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Not waiting for response from instrument (:result_type nil).&quot;</span>, <span class="ruby-keyword">self</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:socket_close</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:socket_close_write</span>] <span class="ruby-keyword">then</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Closing TCP connection.&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-ivar">@tcpSocket</span>.<span class="ruby-identifier">close</span>()
        <span class="ruby-ivar">@tcpSocket</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:t3k</span> <span class="ruby-keyword">then</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Sending Command: #{strToSend.inspect}&quot;</span>, <span class="ruby-keyword">self</span>)
      <span class="ruby-identifier">res</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">post_form</span>(<span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;http://#{@gblOpt[:ip_address]}:#{@gblOpt[:net_port]}/Comm.html&quot;</span>), { <span class="ruby-string">&#39;COMMAND&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">strToSend</span> })
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">strWeGot</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^.*NAME=&quot;name&quot;&gt;/m</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/&lt;\/TEXTAREA.*$/m</span>, <span class="ruby-string">&#39;&#39;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">strWeGot</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:print_raw_result</span>] <span class="ruby-keyword">then</span>
              <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">outPrinter</span>(<span class="ruby-identifier">strWeGot</span>, <span class="ruby-identifier">newline</span>=<span class="ruby-keyword">false</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: unknown protocol: #{@gblOpt[:net_protocol].inspect}&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">77</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">time_exe_done</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-comment"># Command execution is complete</span>
  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: Raw result string: #{strWeGot[0..100].inspect}&quot;</span>, <span class="ruby-keyword">self</span>)
  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Execution time: #{time_exe_done - time_exe_start}&quot;</span>, <span class="ruby-keyword">self</span>)

  <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">strWeGot</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_extract_block</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;#&#39;</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">blockHeadLen</span> = <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">1</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">blockHeadLen</span>.<span class="ruby-identifier">zero?</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">2</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">blockBodyLen</span> = <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">2</span>, <span class="ruby-identifier">blockHeadLen</span>].<span class="ruby-identifier">to_i</span>()
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-identifier">blockHeadLen</span><span class="ruby-value">+2</span>, <span class="ruby-identifier">blockBodyLen</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_split</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-value">:char</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;[#{@gblOpt[:result_split_arg]}]&quot;</span>, <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">MULTILINE</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:regex</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_split_arg</span>],        <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">MULTILINE</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:space</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:split_space</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:line</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:split_line</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:csv</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:split_csv</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:ssv</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:split_ssv</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:string</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_split_arg</span>])
    <span class="ruby-keyword">when</span> <span class="ruby-value">:unpack</span>
      <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_split_arg</span>])
    <span class="ruby-keyword">when</span> <span class="ruby-value">:block</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;#&#39;</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">blockHeadLen</span> = <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">1</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">blockHeadLen</span>.<span class="ruby-identifier">zero?</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">thingyWeReturn</span> = [ <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">0</span>, <span class="ruby-value">2</span>], <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">2</span>) ]
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">blockBodyLen</span> = <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">2</span>, <span class="ruby-identifier">blockHeadLen</span>].<span class="ruby-identifier">to_i</span>()
          <span class="ruby-identifier">thingyWeReturn</span> = [ <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">blockHeadLen</span><span class="ruby-value">+2</span>], <span class="ruby-identifier">thingyWeReturn</span>[<span class="ruby-identifier">blockHeadLen</span><span class="ruby-value">+2</span>, <span class="ruby-identifier">blockBodyLen</span>] ]
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">thingyWeReturn</span> = [ <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">thingyWeReturn</span> ]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">thingyWeReturn</span> = [ <span class="ruby-identifier">thingyWeReturn</span> ]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_squeeze</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:split_space</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">m</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:split_line</span>)) <span class="ruby-operator">?</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot; &quot;</span>); } <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_chomp</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_strip</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_last_word</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">rstrip</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^.* /</span>, <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">:mixed</span> <span class="ruby-keyword">then</span>  <span class="ruby-comment"># It can&#39;t be nil if we get to this line</span>
    <span class="ruby-keyword">case</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>]
      <span class="ruby-keyword">when</span> <span class="ruby-value">:string</span>
        <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>)
      <span class="ruby-keyword">when</span> <span class="ruby-value">:float</span>
        <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Numeric</span>)) <span class="ruby-operator">?</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
      <span class="ruby-keyword">when</span> <span class="ruby-value">:int</span>
        <span class="ruby-comment"># TODO: Add support for hex, oct, &amp; binary integers</span>
        <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> ((<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Numeric</span>)) <span class="ruby-operator">?</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
      <span class="ruby-keyword">when</span> <span class="ruby-value">:bool</span>
        <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:o488_TRUEx</span>)) <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:o488_FALSEx</span>)) <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">x</span>) }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_split</span>]) <span class="ruby-keyword">then</span>  <span class="ruby-comment"># If we didn&#39;t split, then we return a scaler</span>
    <span class="ruby-identifier">thingyWeReturn</span> = <span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: Result we return: #{thingyWeReturn.to_s[0..100].inspect}&quot;</span>, <span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:name</span>    <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:name</span>],
                   <span class="ruby-value">:cmd_str</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:store_cmd</span>]         <span class="ruby-operator">?</span> <span class="ruby-identifier">strToSend</span>      <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>),
                   <span class="ruby-value">:ret_val</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:store_results</span>]     <span class="ruby-operator">?</span> <span class="ruby-identifier">thingyWeReturn</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>),
                   <span class="ruby-value">:raw_str</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:store_raw_results</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">strWeGot</span>       <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
                 })
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:store_last_in_ans</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@varList</span>[<span class="ruby-string">&#39;ANS&#39;</span>] = <span class="ruby-identifier">thingyWeReturn</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:store_named_in_var</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:name</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@varList</span>[<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:name</span>]] = <span class="ruby-identifier">thingyWeReturn</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:result_type</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:print_result</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">outPrinter</span>(<span class="ruby-identifier">thingyWeReturn</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">newline</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:delay_after_complete</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: DELAY: between_timeout = #{@gblOpt[:delay_after_complete]}ms.&quot;</span>, <span class="ruby-keyword">self</span>)
    <span class="ruby-identifier">sleep</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:delay_after_complete</span>]<span class="ruby-operator">/</span><span class="ruby-value">1000.0</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">thingyWeReturn</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-expand" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">expand</span><span
            class="method-args">(instr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Return a new string with constructs like ${variable_name} &amp; ${variable_name:default_value} expanded into the value of the variable(s).</p>

          <div class="method-source-code" id="expand-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 668</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expand</span> (<span class="ruby-identifier">instr</span>)
  <span class="ruby-identifier">expCnt</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">instr</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-ivar">@re</span>.<span class="ruby-identifier">a</span>(<span class="ruby-value">:mrs_varexp</span>)) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">varName</span>    = <span class="ruby-node">$1</span>
    <span class="ruby-identifier">varDefault</span> = <span class="ruby-node">$2</span>
    <span class="ruby-identifier">expCnt</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@varList</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">varName</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">next</span> <span class="ruby-ivar">@varList</span>[<span class="ruby-identifier">varName</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">varDefault</span> <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">next</span> <span class="ruby-identifier">varDefault</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Unknown variable (#{varName}) without default value!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">88</span>)
        <span class="ruby-keyword">next</span> <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">instr</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">result</span><span
            class="method-args">(index: -1, type: :ret_val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>After execution SCPI commands have several data elements stored, and this method provides access to that data.</p>
<ul><li><dl class="rdoc-list note-list"><dt><code>index</code>
<dd>
<p>Specify SCPI command for which to return data.</p>
</dd></dl>
<ul><li>
<p>An integer: Return the result at the given array index. Some notes:</p>
<ul><li>
<p>This option is fast at O(1).</p>
</li><li>
<p><code>-1</code> is the last SCPI command</p>
</li><li>
<p><code>0</code> is the first one. </p>
</li></ul>
</li><li>
<p>A string: Return an <strong>array</strong> of all results with a matching <code>:name</code> ordered by index.  Some notes:</p>
<ul><li>
<p>An empty array is returned if no matches are found. </p>
</li><li>
<p>This option is slow at O(n) – n # results.</p>
</li><li>
<p>The option <code>:store_named_in_var</code> and the <a href="SCPIsession.html#method-i-variable"><code>variable</code></a> method are much faster; however, this only gets tht <strong>last</strong> result with the given name.</p>
</li></ul>
</li></ul>
</li><li><dl class="rdoc-list note-list"><dt><code>type</code>
<dd>
<p>A symbol specifing the data to return. The symbol must be one of: </p>
</dd></dl>
<ul><li><dl class="rdoc-list note-list"><dt><code>:all</code>
<dd>
<p>A hash with all data</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:name</code>
<dd>
<p>String with the command name/variable</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:cmd_str</code>
<dd>
<p>String sent to the instrument</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:ret_val</code>
<dd>
<p>Processed result from the command</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>:raw_str</code>
<dd>
<p>String received from the instrument</p>
</dd></dl>
</li></ul>
</li></ul>

          <div class="method-source-code" id="result-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 974</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">result</span>(<span class="ruby-value">index:</span> <span class="ruby-value">-1</span>, <span class="ruby-value">type:</span> <span class="ruby-value">:ret_val</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">ret</span> = <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:name</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">index</span> }
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:all</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">clone</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">ret</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-identifier">type</span>] }.<span class="ruby-identifier">clone</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">clone</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:all</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@results</span>[<span class="ruby-identifier">index</span>].<span class="ruby-identifier">clone</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@results</span>[<span class="ruby-identifier">index</span>][<span class="ruby-identifier">type</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set</span><span
            class="method-args">(options=Hash.new)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Set state parameters – see the parameter list in the main documentation for the <a href="SCPIsession.html"><code>SCPIsession</code></a> class.</p>

          <div class="method-source-code" id="set-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 519</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set</span>(<span class="ruby-identifier">options</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
  <span class="ruby-identifier">objectUnderConstruction</span> = <span class="ruby-ivar">@gblOpt</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># Take care of pseudo-option :good_std_eot</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value">:good_std_eot</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:good_std_eot</span>] 
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:read_eot_sentinel</span>] = <span class="ruby-string">&quot;\n&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:read_eot_sentinel</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:good_std_eot</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># Take care of pseudo-options :result_macro_*</span>
  { <span class="ruby-value">:result_macro_bin</span>   <span class="ruby-operator">=&gt;</span> { <span class="ruby-value">:result_extract_block</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_split</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,  <span class="ruby-value">:result_chomp</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_strip</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_last_word</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:string</span>, <span class="ruby-value">:print_max_len</span> <span class="ruby-operator">=&gt;</span>  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:print_debug</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span> },
    <span class="ruby-value">:result_macro_block</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-value">:result_extract_block</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_split</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,  <span class="ruby-value">:result_chomp</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_strip</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_last_word</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:string</span>, <span class="ruby-value">:print_max_len</span> <span class="ruby-operator">=&gt;</span>  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:print_debug</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span> },
    <span class="ruby-value">:result_macro_ascii</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-value">:result_extract_block</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_split</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,  <span class="ruby-value">:result_chomp</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_strip</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_last_word</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:string</span>, <span class="ruby-value">:print_max_len</span> <span class="ruby-operator">=&gt;</span>  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:print_debug</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span> },
    <span class="ruby-value">:result_macro_debug</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-value">:result_extract_block</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_split</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,  <span class="ruby-value">:result_chomp</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_strip</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_last_word</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:string</span>, <span class="ruby-value">:print_max_len</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">1024</span>, <span class="ruby-value">:print_debug</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>  },
    <span class="ruby-value">:result_macro_csv</span>   <span class="ruby-operator">=&gt;</span> { <span class="ruby-value">:result_extract_block</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_split</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:csv</span>, <span class="ruby-value">:result_chomp</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_strip</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,  <span class="ruby-value">:result_last_word</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:result_type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:string</span>, <span class="ruby-value">:print_max_len</span> <span class="ruby-operator">=&gt;</span>  <span class="ruby-keyword">nil</span>, <span class="ruby-value">:print_debug</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span> },
  }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">macro_sym</span>, <span class="ruby-identifier">macro_options</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">macro_sym</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">macro_options</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">macro_opt_sym</span>, <span class="ruby-identifier">macro_opt_val</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">options</span>[<span class="ruby-identifier">macro_opt_sym</span>] = <span class="ruby-identifier">macro_opt_val</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">macro_sym</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># Take care of pseudo-options for PrintyPrintyBangBang</span>
  <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># Take care of pseudo-option :echo</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value">:echo</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:print_cmd</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-value">:echo</span>]
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:print_result</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-value">:echo</span>]
    <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:echo</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># Take care of pseudo-option :url -&gt; zap it and expand it into :net_protocol, :ip_address, :net_port</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value">:url</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">urlBits</span> = <span class="ruby-constant">SCPIrcFile</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">urlParser</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:url</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">urlBits</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">urlBits</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">if</span> (<span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">3</span>, <span class="ruby-node">&quot;INFO: Explicit #{k.inspect} option (#{options[k].inspect}) overrode value in URL: #{options[:url].inspect}&quot;</span>, <span class="ruby-keyword">self</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>;
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:url</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># Set values provided in arguments</span>
  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOptReqNew</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@gblOptReqRun</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@gblOptReqPsu</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">objectUnderConstruction</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gblOptReqNew</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Option can&#39;t be set post new: #{k.inspect}&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">71</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Unknown Session Option: #{k.inspect} =&gt; #{v.inspect}&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">72</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># If we are constructing the object, then work harder</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">objectUnderConstruction</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-ivar">@gblOpt</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value">:net_protocol</span>)) <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>] = <span class="ruby-value">:raw</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># Apply rules to set unset options</span>
    { <span class="ruby-value">:net_port</span>                 <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:file</span><span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:raw</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">5025</span>, <span class="ruby-value">:soip</span><span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:plgx</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">1234</span>, <span class="ruby-value">:lxi</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:t3k</span><span class="ruby-operator">=&gt;</span>  <span class="ruby-value">80</span>},
      <span class="ruby-value">:delay_after_complete</span>     <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:file</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:raw</span><span class="ruby-operator">=&gt;</span>    <span class="ruby-value">0</span>, <span class="ruby-value">:soip</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">100</span>, <span class="ruby-value">:plgx</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">50</span>, <span class="ruby-value">:lxi</span> <span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:t3k</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">200</span>},
      <span class="ruby-value">:delay_before_first_read</span>  <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:file</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:raw</span><span class="ruby-operator">=&gt;</span>  <span class="ruby-value">100</span>, <span class="ruby-value">:soip</span><span class="ruby-operator">=&gt;</span>  <span class="ruby-value">50</span>, <span class="ruby-value">:plgx</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">10</span>, <span class="ruby-value">:lxi</span> <span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:t3k</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>},
      <span class="ruby-value">:read_retry_delay</span>         <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:file</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:raw</span><span class="ruby-operator">=&gt;</span>  <span class="ruby-value">200</span>, <span class="ruby-value">:soip</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">200</span>, <span class="ruby-value">:plgx</span><span class="ruby-operator">=&gt;</span>  <span class="ruby-value">100</span>, <span class="ruby-value">:lxi</span> <span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:t3k</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>},
      <span class="ruby-value">:read_timeout_first_byte</span>  <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:file</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:raw</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">1000</span>, <span class="ruby-value">:soip</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">500</span>, <span class="ruby-value">:plgx</span><span class="ruby-operator">=&gt;</span>  <span class="ruby-value">600</span>, <span class="ruby-value">:lxi</span> <span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:t3k</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>},
      <span class="ruby-value">:read_timeout_next_byte</span>   <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:file</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:raw</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">2000</span>, <span class="ruby-value">:soip</span><span class="ruby-operator">=&gt;</span> <span class="ruby-value">100</span>, <span class="ruby-value">:plgx</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">50</span>, <span class="ruby-value">:lxi</span> <span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>, <span class="ruby-value">:t3k</span><span class="ruby-operator">=&gt;</span>   <span class="ruby-value">0</span>}
    }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">defs</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-ivar">@gblOpt</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>)) <span class="ruby-operator">||</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
        <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">defs</span>[<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>]]
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
          <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">2</span>, <span class="ruby-node">&quot;WARNING: Could not set #{k} to a default value!&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-node">&quot;DEBUG-4: Successfully set #{k} to a default value!&quot;</span>, <span class="ruby-keyword">self</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># Make sure all options required by new are set and valid</span>
    <span class="ruby-ivar">@gblOptReqNew</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">validator</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">validator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-identifier">k</span>])) <span class="ruby-keyword">then</span>
        <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Option required by new is invalid: #{k} = #{@gblOpt[k].inspect}!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">73</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> [<span class="ruby-value">:lxi</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:net_protocol</span>]) <span class="ruby-keyword">then</span> <span class="ruby-comment"># (TODO: Future Feature)</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-string">&quot;ERROR: :lxi is not currently supported -- it will be someday!!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">86</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Object fully constructed.&quot;</span>, <span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">else</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-ivar">@gblOpt</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">8</span>, <span class="ruby-node">&quot;DEBUG-8: @gblOpt: #{(k.to_s+&#39; &#39;).ljust(25, &#39;.&#39;)} #{@gblOpt[k].inspect}&quot;</span>, <span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#---------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="ruby-comment"># If we got a :cmd &amp; :execute_on_cmd is on, then we attempt to execute</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value">:cmd</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gblOpt</span>[<span class="ruby-value">:execute_on_cmd</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">4</span>, <span class="ruby-string">&quot;DEBUG-4: Attempting automatic execution&quot;</span>, <span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute</span>()
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-variable" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">variable</span><span
            class="method-args">(name, value=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Access, or set when <code>value</code> is non-<code>nil</code>, a <a href="SCPIsession.html"><code>SCPIsession</code></a> variable.</p>

          <div class="method-source-code" id="variable-source">
            <pre><span class="ruby-comment"># File src/mrSCPI.rb, line 653</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">variable</span> (<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@varList</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@varList</span>[<span class="ruby-identifier">name</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">PrintyPrintyBangBang</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">logPrinter</span>(<span class="ruby-value">1</span>, <span class="ruby-node">&quot;ERROR: Result not found with given name: #{name.inspect}!&quot;</span>, <span class="ruby-keyword">self</span>, <span class="ruby-value">75</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@varList</span>[<span class="ruby-identifier">name</span>]  = <span class="ruby-identifier">value</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

